<html lang="ko" xml:lang="ko" xmlns="http://www.w3.org/1999/xhtml" class=""
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/default_layout}">
<head>
    <!--403 error 방지 csrf token 추가-->
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>김다빈님의 정보 | Hashcode</title>
    <link rel="shortcut icon" type="image/x-icon" href="https://hashcode.co.kr/assets/favicon/favicon-5256b45a294911c4573434fd8c57b7c2e4b0958bb2a10266d27a240360691767.ico">
    <link rel="apple-touch-icon" type="image/png" href="https://hashcode.co.kr/assets/favicon/apple-touch-icon-d5908b1dee004f60c43142ddf9c90297c5ff1c0df11450cc7d038cea90fef1a1.png">
    <meta name="theme-color" content="#5C6BC0">

    <link rel="stylesheet" media="all" href="CSS/myPage.css">
    <link rel="stylesheet" media="all" href="CSS/myPageSetting.css">
    <meta name="csrf-param" content="authenticity_token">
    <meta name="csrf-token" content="0jUKSZjoRD8A1VmNJx6f8VHZIPsjHPmEjfpeutB1AU4Bd2W/rNAkbI4Vh8wiJOLLYCsf3DuzBu1/TMqCvIlIlA==">


</head>

<body class="users users-show" data-controller="users" data-action="show" layout:fragment="content">
<div class="main">
    <div class="content clearfix">
        <div class="content-wrap clearfix">
            <div class="info">
      <span class="file-upload m-b-40">
        <div class="clickable-area">
          <div id="preview" class="preview m-b-10">
            <h5 class="upload"><span class="hc-icons-camera white-color">사진업로드</span> 사진 업로드</h5>
            <img alt="김다빈" class="profile-image" src="https://res.cloudinary.com/eightcruz/image/upload/c_lfill,h_220,w_220/ubevjgwgfypffgeiaaf5">
          </div>
          <input type="file" name="file" data-url="https://api.cloudinary.com/v1_1/eightcruz/auto/upload" data-form-data="{&quot;callback&quot;:&quot;https://hashcode.co.kr/cloudinary_cors.html&quot;,&quot;timestamp&quot;:1626482845,&quot;upload_preset&quot;:&quot;athena&quot;,&quot;signature&quot;:&quot;84e795f718b67a2c45a5834ae39e33395f342730&quot;,&quot;api_key&quot;:&quot;689685655922254&quot;}" data-cloudinary-field="image_id" class="cloudinary-fileupload">
        </div>
      </span>
                <h5 class="float-xs-right settings"><a href="https://hashcode.co.kr/user/edit">설정</a></h5>
                <div class="name-edit">
                    <h1 class="name" th:text="${user.getUserName()}">
                    </h1>
                    <a data-remote="true" href="javascript:openModal(1)" >수정</a>
                </div>
                <div class="detail-info">
                    <!--소개-->
                    <div id="introduction-edit" class="user-information">
                        <span class="hc-icons-introduction hc-icons">id</span>
                        <span>
                            <span id="introduction" th:text="${user.getUserBio()}"> </span>
                            <a data-remote="true" href="javascript:openModal(2)" th:text="${user.getUserBio()!=null} ? '수정' : '등록'"></a>
                        </span>
                    </div>

                    <!--홈페이지-->
                    <div id="homepage-edit" class="user-information">
                        <span class="hc-icons-homepage hc-icons">id</span>
                        <span>
                            <span id="homepage" th:text="${user.getUserHomepage()}"> </span>
                            <a data-remote="true" href="javascript:openModal(3)" th:text="${user.getUserHomepage()!=null} ? '수정' : '등록'"></a>
                        </span>
                    </div>

                    <!--주소-->
                    <div id="location-edit" class="user-information">
                        <span class="hc-icons-location hc-icons">id</span>
                        <span>
                            <span id="location" th:text="${user.getUserAddress()}"> </span>
                            <a data-remote="true" href="javascript:openModal(4)" th:text="${user.getUserAddress()!=null} ? '수정' : '등록'"></a>
                        </span>
                    </div>

                    <!--소속-->
                    <div id="organization-edit" class="user-information">
                        <span class="hc-icons-organization hc-icons">id</span>
                        <span>
                            <span id="organization" th:text="${user.getUserCompany()}"> </span>
                            <a data-remote="true" href="javascript:openModal(5)" th:text="${user.getUserCompany()!=null} ? '수정' : '등록'"></a>
                        </span>
                    </div>

                    <!--id, title, value, user-->
                    <div id="github" class="user-information">
                        <span class="hc-icons-github hc-icons">id</span>
                        <span>
                            <a target="_blank" href="https://programmers.co.kr/users/account">github 연결하기</a>
                        </span>
                    </div>

                </div>
            </div>

            <ul class="activities">
                <!--user -->
                <li class="activity activity-chart">
                    <h6> 점수 </h6>
                    <div class="img-center"><img src="../image/egg01.gif"></div>
                </li>
                <!--user, questions_count, answers_count-->
                <li class="activity activity-count">
                    <h6> 활동 </h6>
                    <div class="img-center"><img src="../image/egg02.gif"></div>
                </li>
                <!--top_tags-->
                <li class="activity activity-tags">
                    <h6>태그</h6>
                    <div class="img-center"><img src="../image/egg03.gif"></div>
                </li>
            </ul>

            <!--메뉴-->
            <ul class="nav nav-tabs" id="tab" role="tablist">
                <!--질문-->
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="question-tab" data-bs-toggle="tab" data-bs-target="#question" type="button" role="tab" aria-controls="question" aria-selected="true">질문 0</button>
                </li>
                <!--답변-->
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="answer-tab" data-bs-toggle="tab" data-bs-target="#answer" type="button" role="tab" aria-controls="answer" aria-selected="false">답변 0</button>
                </li>
                <!--편집요청-->
                <li class="nav-item">
                    <button class="nav-link" id="edit_request-tab" data-bs-toggle="tab" data-bs-target="#edit_request" type="button" role="tab" aria-controls="edit_request" aria-selected="false">편집 요청 0</button>
                </li>
                <!--북마크-->
                <li class="nav-item">
                    <button class="nav-link" id="bookmark-tab" data-bs-toggle="tab" data-bs-target="#bookmark" type="button" role="tab" aria-controls="contact" aria-selected="false">북마크 1</button>
                </li>
                <!--정렬-->
                <li class="nav-item dropdown float-xs-right">
                    <a class="nav-link dropdown-toggle" id="actions" data-toggle="dropdown" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        최신순
                    </a>
                    <div class="dropdown-menu" aria-labelledby="actions">
                        <a class="dropdown-item" href="/users/187759/%EA%B9%80%EB%8B%A4%EB%B9%88?sortby=newest">최신순</a>
                        <a class="dropdown-item" href="/users/187759/%EA%B9%80%EB%8B%A4%EB%B9%88?sortby=votes">추천순</a>
                    </div>
                </li>
            </ul>

            <!--출력-->
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="question" role="tabpanel" aria-labelledby="question-tab">
                    <ul class="question-list">
                        <h5 class="m-t-30">등록한 질문이 없습니다.</h5>
                    </ul>
                </div>
                <div class="tab-pane fade" id="answer" role="tabpanel" aria-labelledby="answer-tab">
                    <ul class="answer-list">
                        <h5 class="m-t-30">등록한 답변이 없습니다.</h5>
                    </ul>
                </div>
                <div class="tab-pane fade" id="edit_request" role="tabpanel" aria-labelledby="edit_request-tab">
                    <ul class="question-list">
                        <h5 class="m-t-30">요청한 편집글이 없습니다.</h5>
                    </ul>
                </div>
                <div class="tab-pane fade" id="bookmark" role="tabpanel" aria-labelledby="bookmark-tab">
                    <ul class="question-list">
                        <li id="question-14042" class="question-list-item hidden-sm-down">
                            <div class="question-vote-count" data-id="14042">
                                <div class="question-number">0</div>
                                <h6>좋아요</h6>
                            </div>
                            <div class="question-answer-count accepted" data-id="14042">
                                <div class="question-number">✓1</div>
                                <h6>답변</h6>
                            </div>
                            <div class="question">
                                <div class="top">
                                    <h4><a href="/questions/14042/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%B4%88%EB%B3%B4-list-insert-%EA%B4%80%EB%A0%A8-%EC%A7%88%EB%AC%B8-indexerror-list-assignment-index-out-of-range">파이썬 초보. list insert 관련 질문. IndexError: list assignment index out of range</a></h4>
                                </div>
                                <ul class="question-tags">
                                </ul>

                                <ul class="question-info float-xs-right">
                                    <li><time datetime="2021-06-27T13:14:21+09:00">20일 전</time></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>



        </div>
    </div>
</div>

<!--modal-->
<div class="swal2-container swal2-center swal2-fade swal2-shown" style="overflow-y: auto;display: none" id="modal">
    <div aria-labelledby="swal2-title" aria-describedby="swal2-content" class="swal2-popup swal2-modal swal2-show" tabindex="-1" role="dialog" aria-live="assertive" aria-modal="true" style="display: flex;">
        <div class="swal2-header">
            <h2 class="swal2-title" id="swal2-title"></h2>
        </div>
        <form id="modal-form" >
        <div class="swal2-content">
            <div id="swal2-content" style="display: block;">
                <p><input type="text" id="input-field" style="padding: 5px; width: 70%;"></p>
            </div>
        </div>
        <div class="swal2-actions" style="display: flex;">
            <button type="button" class="swal2-confirm swal2-styled" aria-label="" id="modal-submit" style="border-left-color: rgb(48, 133, 214); border-right-color: rgb(48, 133, 214);">확인</button>
            <button type="button" class="swal2-cancel swal2-styled" aria-label="" style="display: inline-block;" id="modal-close">취소</button></div>
        </form>
    </div>
</div>

<!--    부트스트랩-->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

<script th:inline="javascript">
    //csrf token 추가
    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");
    var modalNum;


    let userInfo = /*[[${user}]]*/ null;
    console.log(userInfo);
    console.log(userInfo.userName);

    $("#modal-close").click(function (event) {
        $("#modal").css("display","none");
    })

    function openModal(modalName){
        console.log("openModal 이벤트 발생");
        switch (modalName){
            case 1:
                $("#swal2-title").text("이름을 등록해주세요.");
                $("#input-field").val(userInfo.userName);
                break;
            case 2:
                $("#swal2-title").text("자기소개를 등록해주세요.");
                if(userInfo.userBio==null)
                    $("input-field").val('');
                else {
                    console.log("제대로 대는뎅"+userInfo.userBio);
                    $("#input-field").val(userInfo.userBio);
                }
                break;
            case 3:
                $("#swal2-title").text("홈페이지를 등록해주세요.");
                if(userInfo.userHomepage==null)
                    $("#input-field").val('');
                else
                    $("#input-field").val(userInfo.userHomepage);
                break;
            case 4:
                $("#swal2-title").text("주소를 등록해주세요.");
                if(userInfo.userAddress==null)
                    $("#input-field").val('');
                else
                    $("#input-field").val(userInfo.userAddress);
                break;
            case 5:
                $("#swal2-title").text("소속을 등록해주세요.");
                if(userInfo.userCompany==null)
                    $("#input-field").val('');
                else
                    $("#input-field").val(userInfo.userCompany);
                break;
        }
        $("#modal").css("display","flex");
        modalNum=modalName;
    }

    //확인 버튼 누르면
    $("#modal-submit").click(function () {
        var change=$("#input-field").val();

        if(change==''){
            console.log("널값");
            change=null;
        }
        switch (modalNum){
            case 1:
                userInfo.userName=change;
                $(".name").text(userInfo.userName);
                break;
            case 2:
                userInfo.userBio=change;
                $("#introduction").text(userInfo.userBio);
                break;
            case 3:
                userInfo.userHomepage=change;
                $("#homepage").text(userInfo.userHomepage);
                break;
            case 4:
                userInfo.userAddress=change;
                $("#location").text(userInfo.userAddress);
                break;
            case 5:
                userInfo.userCompany=change;
                $("#organization").text(userInfo.userCompany);
                break;
        }
        $.ajax({
            type:'POST',
            url:'/users/myPage',
            data:JSON.stringify(userInfo),
            contentType:"application/json; charset=UTF-8",
            success : function (data){
                $("#modal-close").trigger("click"); //성공했을 경우 모달창 자동으로 닫히도록 함.
            },
            error:function(errorThrown){
                alert(errorThrown.statusText); //실패했을 경우 error alert 발생
            },
            //헤더에 csrf 토큰 추가
            beforeSend: function(xhr) {
                xhr.setRequestHeader(header, token);
            }

        });
    })

</script>

</body>